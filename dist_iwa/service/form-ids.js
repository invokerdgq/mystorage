"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _extends=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},_createClass=function(){function n(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,r,t){return r&&n(e.prototype,r),t&&n(e,t),e}}(),_index=require("../api/index.js"),_index2=_interopRequireDefault(_index),_index3=require("../utils/index.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var s=e.apply(this,arguments);return new Promise(function(i,a){return function r(e,t){try{var n=s[e](t),o=n.value}catch(e){return void a(e)}if(!n.done)return Promise.resolve(o).then(function(e){r("next",e)},function(e){r("throw",e)});i(o)}("next")})}}function _toConsumableArray(e){if(Array.isArray(e)){for(var r=0,t=Array(e.length);r<e.length;r++)t[r]=e[r];return t}return Array.from(e)}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var FormIds=function(){function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,r),this._collectingFormIdsTimer=null,this._formIds=[],this.options=_extends({duration:3e4},e)}var e;return _createClass(r,[{key:"startCollectingFormIds",value:function(){var e=this;this._collectingFormIdsTimer&&clearInterval(this._collectingFormIdsTimer);this._collectingFormIdsTimer=setInterval(function(){e.flush()},this.options.duration),_index3.log.debug("[form-ids] start collecting")}},{key:"collectFormIds",value:function(e,r){e&&(Array.isArray(e)||(e=[e]),r?this.flush(e):this._formIds=[].concat(_toConsumableArray(this._formIds),_toConsumableArray(e)))}},{key:"flush",value:(e=_asyncToGenerator(getApp().regeneratorRuntime.mark(function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];return getApp().regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&(r=[].concat(_toConsumableArray(this._formIds),_toConsumableArray(r))),(r=r.filter(function(e){return"the formId is a mock one"!==e})).length){e.next=4;break}return e.abrupt("return");case 4:return r=r.join(","),_index3.log.debug("[form-ids] sending ids: ",r),e.prev=6,e.next=9,_index2.default.member.fomrId(r);case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(6),console.log(e.t0);case 14:n&&(this._formIds=[]);case 15:case"end":return e.stop()}},e,this,[[6,11]])})),function(){return e.apply(this,arguments)})},{key:"stop",value:function(){this._collectingFormIdsTimer&&(clearInterval(this._collectingFormIdsTimer),_index3.log.debug("[form-ids] stop collecting"))}}]),r}();exports.default=new FormIds;