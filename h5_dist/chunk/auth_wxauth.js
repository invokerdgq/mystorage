(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{"659":function(e,t,n){},"777":function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return d});var r=n(3),o=n(347),a=n(346),i=n(4),c=n(747),u=n(376),s=n(362),p=n(15),l=n(16),f=(n(659),function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}()),h=function get(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:get(o,t,n)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(n):void 0};function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function step(r,o){try{var a=t[r](o),i=a.value}catch(e){return void n(e)}if(!a.done)return Promise.resolve(i).then(function(e){step("next",e)},function(e){step("throw",e)});e(i)}("next")})}}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var d=function(e){function WxAuth(){var e,t,n,r,c=this;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,WxAuth);for(var u=arguments.length,s=Array(u),f=0;f<u;f++)s[f]=arguments[f];return t=n=_possibleConstructorReturn(this,(e=WxAuth.__proto__||Object.getPrototypeOf(WxAuth)).call.apply(e,[this].concat(s))),n.state={"isAuthShow":!1},n.handleGetUserInfo=(r=_asyncToGenerator(regeneratorRuntime.mark(function _callee(e){var t,r,u,s,f,h,d,y,b,_,m,v,w;return regeneratorRuntime.wrap(function _callee$(c){for(;;)switch(c.prev=c.next){case 0:if(t=e.detail,r=t.iv,u=t.encryptedData,s=t.rawData,f=t.signature,h=t.userInfo,r&&u){c.next=5;break}return Object(o.c)({"title":"授权提示","content":"需要您的授权才能购物","showCancel":!1,"confirmText":"知道啦"}),c.abrupt("return");case 5:return c.next=7,Object(a.f)();case 7:return d=c.sent,y=d.code,Object(o.b)({"mask":!0,"title":"正在加载..."}),c.prev=10,c.next=13,p.a.wx.prelogin({"code":y,"iv":r,"encryptedData":u,"rawData":s,"signature":f,"userInfo":h});case 13:if(b=c.sent,_=b.token,m=b.open_id,v=b.union_id,w=b.user_id,l.a.setAuthToken(_),!w){c.next=23;break}return c.next=22,n.autoLogin();case 22:return c.abrupt("return");case 23:i.a.redirectTo({"url":"/pages/auth/reg?code="+y+"&open_id="+m+"&union_id="+v}),c.next=30;break;case 26:c.prev=26,c.t0=c.catch(10),console.info(c.t0),Object(o.d)({"title":"授权失败，请稍后再试","icon":"none"});case 30:Object(o.a)();case 31:case"end":return c.stop()}},_callee,c,[[10,26]])})),function(e){return r.apply(this,arguments)}),n.handleBackHome=function(){i.a.redirectTo({"url":"/pages/index"})},_possibleConstructorReturn(n,t)}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(WxAuth,i["a"].Component),f(WxAuth,[{"key":"componentDidMount","value":function componentDidMount(){this.autoLogin()}},{"key":"autoLogin","value":function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){var e,t,n,r;return regeneratorRuntime.wrap(function _callee2$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,Object(a.f)();case 2:return e=o.sent,t=e.code,o.prev=4,o.next=7,p.a.wx.login({"code":t});case 7:if(n=o.sent,r=n.token){o.next=11;break}throw new Error("token is not defined: "+r);case 11:return l.a.setAuthToken(r),o.abrupt("return",this.redirect());case 15:o.prev=15,o.t0=o.catch(4),console.log(o.t0),this.setState({"isAuthShow":!0});case 19:case"end":return o.stop()}},_callee2,this,[[4,15]])}));return function autoLogin(){return e.apply(this,arguments)}}()},{"key":"redirect","value":function redirect(){var redirect=this.$router.params.redirect,e=redirect?decodeURIComponent(redirect):"/pages/member/index";i.a.redirectTo({"url":e})}},{"key":"render","value":function render(){var e=this.state.isAuthShow;return r.l.createElement(c.a,{"className":"page-wxauth"},e&&r.l.createElement(c.a,{"className":"sec-auth"},r.l.createElement(u.a,{"className":"auth-hint"},"需要您的授权才能继续"),r.l.createElement(s.a,{"type":"primary","lang":"zh_CN","openType":"getUserInfo","onGetUserInfo":this.handleGetUserInfo},"点此授权"),r.l.createElement(s.a,{"className":"back-btn","type":"default","onClick":this.handleBackHome.bind(this)},"我再想想")))}},{"key":"componentDidShow","value":function componentDidShow(){h(WxAuth.prototype.__proto__||Object.getPrototypeOf(WxAuth.prototype),"componentDidShow",this)&&h(WxAuth.prototype.__proto__||Object.getPrototypeOf(WxAuth.prototype),"componentDidShow",this).call(this)}},{"key":"componentDidHide","value":function componentDidHide(){h(WxAuth.prototype.__proto__||Object.getPrototypeOf(WxAuth.prototype),"componentDidHide",this)&&h(WxAuth.prototype.__proto__||Object.getPrototypeOf(WxAuth.prototype),"componentDidHide",this).call(this)}}]),WxAuth}()}}]);